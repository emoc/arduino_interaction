/* Utiliser un écran OLED 128x64 monochrome (SSD1306) en I2C
 * pour afficher une image
 * 
 * Formation Arduino, Rennes, Askoria, 29 mai 2018, pierre <at> lesporteslogiques.net
 * 
 * arduino 1.8.2 / zibu @ debian 7 wheezy
 *  + lib. U8G2 2.14.7 "Library for monochrome displays, version 2"  https://github.com/olikraus/u8g2/wiki
 *  
 *  conversion bin / hex / dec http://sebastienguillon.com/test/javascript/convertisseur.html
 * 
 * procédure pour transformer une image et l'afficher avec u8g2
 *   transformer une image avec gimp :
 *    - image / échelle et taille de l'image : passer en 128 x 64
 *    - image / mode / couleurs indexées : passer en n&b 1 bit (avec ou sans algo de dispersion)
 *    - couleurs / inverser les valeurs
 *    - "exporter vers" au format xbm, sans cocher d'options
 *    - ouvrir le fichier xbm dans un éditeur de texte et copier-coller le contenu 
 *           des accolades dans le programme arduino
 *   on peut aussi utiliser ce soft sur windows :
 *     lcd assistant (windows seulement) http://en.radzio.dxp.pl/bitmap_converter/
 *   ou un service en ligne :
 *     http://majer.ch/lcd/adf_bitmap.php
 *     http://javl.github.io/image2cpp/
 */

#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

// constructeur pour le mode page buffer
// toutes procédures graphiques, peu de RAM mais lent!
U8G2_SSD1306_128X64_NONAME_1_HW_I2C ecran(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);

// l'image au format xbm, sous forme d'octets de 8 bits, chacun des bits représente
//   un pixel, les bits à correspondront à un pixel éteint 
#define largeur   128
#define hauteur    64
static const unsigned char bits[] PROGMEM = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x20, 0x08, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x04, 0x00,
   0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x90, 0x80, 0x00, 0x48, 0x08, 0x10, 0x00, 0x00, 0x00, 0x08, 0x40,
   0x08, 0x10, 0x22, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x20, 0x00, 0x00, 0x40, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
   0x01, 0x00, 0x80, 0xbe, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xb5, 0x07, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x01, 0x04, 0x20, 0x00, 0x00, 0xb0, 0xdb,
   0x04, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x70, 0xbb, 0x2d, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x20, 0x08, 0xde, 0xef, 0x56, 0x00, 0x00, 0x5a,
   0x55, 0x0b, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0xba, 0xbd,
   0x9b, 0x00, 0x50, 0x75, 0x5b, 0x29, 0x00, 0x02, 0x00, 0x00, 0x00, 0x01,
   0x00, 0x00, 0xff, 0x77, 0x55, 0x40, 0x6f, 0x85, 0x74, 0x13, 0x00, 0x00,
   0x08, 0x00, 0x00, 0x40, 0x00, 0x00, 0xdb, 0xee, 0xdf, 0xaa, 0x00, 0x10,
   0xc4, 0x6e, 0x04, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xbb,
   0x52, 0x14, 0x95, 0x44, 0x51, 0x25, 0x00, 0x00, 0x00, 0x04, 0x08, 0x00,
   0x80, 0x40, 0xb7, 0xf7, 0xae, 0x41, 0x6a, 0x09, 0x40, 0x4d, 0x00, 0x00,
   0x90, 0x00, 0x00, 0x80, 0x00, 0xe0, 0xfd, 0xdf, 0xb5, 0xb4, 0xd5, 0x4b,
   0xa5, 0x15, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0xc0, 0x7f, 0x5b,
   0xaf, 0x22, 0x95, 0x1a, 0xa0, 0x25, 0x20, 0x00, 0x00, 0x40, 0x20, 0x00,
   0x00, 0xf0, 0xf7, 0xff, 0xaa, 0x04, 0x50, 0x27, 0xa9, 0x1a, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x04, 0x80, 0xf0, 0xde, 0xd6, 0xbb, 0x01, 0xa0, 0x0c,
   0x51, 0x03, 0x00, 0x00, 0x10, 0x02, 0x02, 0x00, 0x00, 0xb0, 0xff, 0xbf,
   0x56, 0x0a, 0xa0, 0x4a, 0xb4, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x04, 0xf0, 0xb7, 0xf5, 0xd6, 0x02, 0x90, 0x0b, 0xe8, 0x02, 0x00, 0x00,
   0x00, 0x08, 0x00, 0x00, 0x00, 0x79, 0xff, 0xdf, 0x2d, 0x09, 0x68, 0x21,
   0x2b, 0x01, 0x81, 0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0xe8, 0x6d, 0xbb,
   0xed, 0x02, 0xa0, 0x02, 0x5d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x7c, 0xff, 0xef, 0x96, 0x0a, 0x5a, 0x48, 0x23, 0x00, 0x00, 0x00,
   0x20, 0x00, 0x00, 0x00, 0x00, 0xe8, 0x5b, 0xdd, 0xba, 0x82, 0x5a, 0xa1,
   0x16, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x80, 0x7d, 0xff, 0x77,
   0x57, 0x85, 0x06, 0x54, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00,
   0xa1, 0xec, 0xdb, 0xee, 0x5a, 0xa9, 0x4a, 0xd4, 0x02, 0x00, 0x00, 0x00,
   0x00, 0x40, 0x00, 0x00, 0x18, 0x7a, 0x7f, 0xdb, 0xb7, 0xaa, 0x22, 0x2d,
   0x01, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x08, 0x54, 0xed, 0xeb, 0x5f,
   0xad, 0x76, 0x84, 0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80,
   0xc3, 0xbc, 0xbe, 0xfa, 0xb6, 0x0d, 0x50, 0x23, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x80, 0xa0, 0xa8, 0xf4, 0xf7, 0xd7, 0xed, 0x4b, 0x69, 0x05,
   0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x08, 0x28, 0x1a, 0xdc, 0xde, 0xbe,
   0xbe, 0x12, 0x5a, 0x01, 0x00, 0x40, 0x08, 0x00, 0x04, 0x10, 0x00, 0x54,
   0x14, 0xf8, 0xfd, 0xf7, 0xfb, 0x45, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x85, 0x0b, 0xec, 0xb7, 0xda, 0x2f, 0xa2, 0x15, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x95, 0x02, 0xb8, 0xfe, 0xff,
   0x6f, 0x55, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x60,
   0x05, 0xf4, 0xdb, 0x7f, 0x55, 0xad, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x08, 0x21, 0x68, 0x45, 0x05, 0xa8, 0xff, 0x7f, 0xb7, 0x5b, 0x01, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0xb8, 0x04, 0xf8, 0xff, 0xeb,
   0xda, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xb1,
   0x75, 0xf5, 0x7f, 0xaf, 0xff, 0x0a, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x00, 0x80, 0x8b, 0x64, 0x8b, 0xfa, 0xdf, 0xfd, 0x56, 0x01, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0xd4, 0xda, 0xf6, 0xfa, 0xed,
   0x37, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xe4, 0xa5, 0x28,
   0xab, 0xd2, 0xaf, 0x7f, 0x4d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x40, 0x85, 0x40, 0x2a, 0xa0, 0xfa, 0xff, 0x15, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xd0, 0x02, 0x12, 0x80, 0xea, 0xff, 0x56,
   0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x96, 0x90,
   0x12, 0x40, 0xef, 0xae, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x20, 0xe4, 0x0a, 0x42, 0x80, 0xea, 0xbf, 0xa9, 0x22, 0x00, 0x00, 0x00,
   0x10, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x55, 0x00, 0x34, 0xad, 0x5a, 0xab,
   0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x52, 0xab, 0xb7,
   0xeb, 0xaa, 0x55, 0x95, 0x02, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xd4, 0xba, 0xb4, 0xaa, 0x15, 0xaa, 0x2a, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x55, 0xd7, 0x16, 0x02, 0x54, 0xa5,
   0x02, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0xd5, 0x96,
   0x54, 0x00, 0x20, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x50, 0x15, 0xa9, 0x02, 0x00, 0x90, 0x24, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x52, 0x01, 0x00, 0x00, 0x00, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x10, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x00,
   0x00, 0x00, 0x00, 0x00 }; 
   
// constructeur pour le mode full screen buffer
// toutes procédures graphiques,rapide mais beaucoup de RAM!
//U8G2_SSD1306_128X64_NONAME_F_HW_I2C ecran(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);

boolean DEBUG = true;

void setup(void) {
  ecran.begin();
  if (DEBUG) Serial.begin(9600);
}

void loop(void) {
  
  // structure do-while pour le mode "page buffer" d'u8g2
  ecran.firstPage();
  do {
    ecran.setContrast(255);
    ecran.drawXBMP(0, 0, largeur, hauteur, bits);
  } while ( ecran.nextPage() );
  
}


